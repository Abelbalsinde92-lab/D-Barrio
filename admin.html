<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D'BARRIO ADMIN</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#F9A825">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{--y:#F9A825;--yb:#FFD700;--bg:#000;--card:#111;--card2:#1a1a1a;--border:#2a2a2a;--text:#fff;--sub:#aaa;--red:#ff4444;--green:#00d856}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Roboto Condensed',sans-serif;-webkit-tap-highlight-color:transparent}
body{background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;padding-bottom:80px}
.hdr{background:var(--card);border-bottom:3px solid var(--y);padding:14px 18px;position:sticky;top:0;z-index:100;display:flex;justify-content:space-between;align-items:center}
.hdr-logo{font-size:1.2rem;font-weight:900;color:var(--y);letter-spacing:-1px;text-transform:uppercase}
.hdr-logo span{color:#fff}
.hdr-back{background:rgba(249,168,37,.15);border:2px solid var(--y);color:var(--y);padding:7px 14px;font-size:.75rem;font-weight:900;cursor:pointer;text-transform:uppercase;text-decoration:none}
.tabs{background:var(--card);border-bottom:3px solid var(--border);display:flex;overflow-x:auto;position:sticky;top:55px;z-index:99;scrollbar-width:none}
.tabs::-webkit-scrollbar{display:none}
.tab{padding:13px 8px;font-size:.65rem;font-weight:900;white-space:nowrap;text-transform:uppercase;color:var(--sub);border-bottom:3px solid transparent;cursor:pointer;flex:1;text-align:center;min-width:55px;position:relative}
.tab.on{color:var(--y);border-bottom-color:var(--y)}
.tab .badge-count{position:absolute;top:6px;right:4px;background:var(--red);color:#fff;border-radius:50%;width:16px;height:16px;font-size:.55rem;display:flex;align-items:center;justify-content:center;font-weight:900}
.content{padding:18px;max-width:1200px;margin:0 auto}
.sec{display:none}.sec.on{display:block}
h2{color:var(--y);font-size:1.3rem;font-weight:900;text-transform:uppercase;border-bottom:3px solid var(--y);padding-bottom:8px;margin-bottom:18px}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:22px}
@media(min-width:600px){.stats{grid-template-columns:repeat(4,1fr)}}
.stat{background:var(--card2);border:3px solid var(--border);padding:16px;text-align:center}
.stat-val{font-size:2rem;font-weight:900;color:var(--y);line-height:1}
.stat-lbl{font-size:.6rem;color:var(--sub);text-transform:uppercase;letter-spacing:1px;margin-top:5px;font-weight:700}
.card{background:var(--card);border:3px solid var(--border);margin-bottom:12px;box-shadow:0 4px 0 #000}
.card.hl{border-color:var(--y);box-shadow:0 4px 0 #c17900}
.card.cand{border-color:#0088ff;box-shadow:0 4px 0 #005cb2}
.card-hdr{padding:15px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;gap:10px}
.card-hdr:active{background:#0a0a0a}
.card-title{font-weight:900;font-size:.95rem;text-transform:uppercase;color:#fff}
.card-sub{font-size:.7rem;color:var(--sub);margin-top:3px}
.card-body{padding:0 15px;max-height:0;overflow:hidden;transition:max-height .4s ease,padding .3s ease}
.card.open .card-body{padding:15px;max-height:4000px}
.arrow{color:var(--y);font-size:.9rem;transition:transform .3s;flex-shrink:0}
.card.open .arrow{transform:rotate(180deg)}
.badge{padding:4px 10px;font-size:.62rem;font-weight:900;text-transform:uppercase;flex-shrink:0}
.badge-y{background:var(--y);color:#000}
.badge-r{background:var(--red);color:#fff}
.badge-g{background:var(--green);color:#000}
.badge-o{background:#ff9500;color:#000}
.badge-b{background:#0088ff;color:#fff}
.pulse{animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
.dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.dot-g{background:var(--green)}.dot-r{background:var(--red)}
.fld{margin-bottom:12px}
.fld label{display:block;font-size:.62rem;font-weight:900;color:var(--sub);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.fld input,.fld select,.fld textarea{width:100%;background:#000;border:2px solid var(--border);color:#fff;padding:12px;font-family:'Roboto Condensed',sans-serif;font-size:.9rem;font-weight:700}
.fld input:focus,.fld select:focus,.fld textarea:focus{outline:none;border-color:var(--y)}
.fld select option{background:#111;color:#fff}
.btn{padding:12px 16px;border:none;font-family:'Roboto Condensed',sans-serif;font-weight:900;font-size:.85rem;cursor:pointer;text-transform:uppercase;display:block;width:100%;margin:5px 0}
.btn-y{background:var(--y);color:#000;box-shadow:0 4px 0 #c17900}
.btn-y:active{transform:translateY(4px);box-shadow:none}
.btn-g{background:transparent;border:2px solid var(--green);color:var(--green)}
.btn-b{background:transparent;border:2px solid #0088ff;color:#0088ff}
.btn-r{background:rgba(255,68,68,.15);border:2px solid var(--red);color:var(--red)}
.btn-blue-solid{background:#0088ff;color:#fff;border:none}
.irow{display:flex;justify-content:space-between;align-items:flex-start;padding:9px 0;border-bottom:1px solid var(--border);gap:10px}
.irow:last-child{border:none}
.ilbl{color:var(--sub);font-size:.78rem;font-weight:700;flex-shrink:0}
.ival{color:#fff;font-weight:900;font-size:.85rem;text-align:right}
.money{color:var(--y);font-weight:900;font-size:1.05rem}
.sep{border:none;border-top:2px solid var(--border);margin:14px 0}
.cfg-box{background:var(--card2);border:3px solid var(--y);padding:20px;margin-bottom:18px}
.cfg-box h3{color:var(--y);font-size:1rem;text-transform:uppercase;margin-bottom:14px;font-weight:900}
.cfg-box.danger{border-color:var(--red)}
.cfg-box.danger h3{color:var(--red)}
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:var(--y);color:#000;padding:13px 22px;font-weight:900;font-size:.9rem;z-index:9999;text-align:center;min-width:240px;pointer-events:none;display:none;box-shadow:0 4px 20px rgba(0,0,0,.6)}
.toast.err{background:var(--red);color:#fff}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.96);z-index:500;display:none;align-items:center;justify-content:center;padding:20px}
.overlay.open{display:flex}
.pin-box{background:var(--card);border:3px solid var(--y);padding:30px;width:100%;max-width:340px;text-align:center}
.pin-box h3{color:var(--y);font-size:1.2rem;margin-bottom:16px;text-transform:uppercase}
.pin-box input{width:100%;background:#000;border:2px solid var(--border);color:#fff;padding:14px;font-size:1.5rem;letter-spacing:6px;text-align:center;margin-bottom:14px}
.empty{color:var(--sub);text-align:center;padding:35px 20px;font-size:.9rem}
.rank{background:var(--y);color:#000;width:24px;height:24px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:900;flex-shrink:0}
/* Modal convertir candidato */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.97);z-index:600;display:none;align-items:flex-start;justify-content:center;overflow-y:auto;padding:20px}
.modal-overlay.open{display:flex}
.modal-box{background:var(--card);border:3px solid var(--y);width:100%;max-width:440px;margin:auto}
.modal-top{background:var(--y);padding:14px 18px;display:flex;justify-content:space-between;align-items:center}
.modal-top h3{font-size:1.1rem;font-weight:900;color:#000;text-transform:uppercase}
.btn-close{background:#000;border:none;color:var(--y);font-size:1.3rem;font-weight:900;cursor:pointer;padding:4px 12px}
.modal-body{padding:20px}
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<div class="overlay" id="overlay-pin">
  <div class="pin-box">
    <h3>ğŸ” PIN de Seguridad</h3>
    <input type="password" id="reset-pin" maxlength="6" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" inputmode="numeric">
    <button class="btn btn-y" onclick="confirmarReset()">CONFIRMAR</button>
    <button class="btn btn-r" onclick="closeOverlay('overlay-pin')">CANCELAR</button>
  </div>
</div>

<div class="modal-overlay" id="modal-candidato">
  <div class="modal-box">
    <div class="modal-top">
      <h3>ğŸ‘· DAR DE ALTA COMO SOCIO</h3>
      <button class="btn-close" onclick="closeOverlay('modal-candidato')">âœ•</button>
    </div>
    <div class="modal-body">
      <p style="color:var(--sub);font-size:.85rem;margin-bottom:16px">Revisa los datos y asigna un PIN para que pueda entrar al sistema.</p>
      <div class="fld"><label>Nombre</label><input type="text" id="m-nom"></div>
      <div class="fld"><label>WhatsApp</label><input type="tel" id="m-tel"></div>
      <div class="fld"><label>Zona</label><input type="text" id="m-zon"></div>
      <div class="fld"><label>Especialidad</label>
        <select id="m-esp">
          <option value="">Seleccionar...</option>
          <option>ğŸš° PlomerÃ­a</option><option>âš¡ Electricidad</option>
          <option>ğŸ”¨ CarpinterÃ­a</option><option>ğŸ§± AlbaÃ±ilerÃ­a</option>
          <option>ğŸ¨ Pintura</option><option>â„ï¸ RefrigeraciÃ³n</option>
          <option>ğŸ”‘ CerrajerÃ­a</option><option>ğŸ’» TecnologÃ­a</option>
          <option>ğŸ”§ Multiservicios</option>
        </select>
      </div>
      <div class="fld"><label>PIN (4 dÃ­gitos)</label><input type="password" id="m-pin" maxlength="4" pattern="[0-9]{4}" inputmode="numeric" placeholder="Ej: 1234"></div>
      <div class="fld"><label>ComisiÃ³n (%)</label><input type="number" id="m-com" min="0" max="100" value="15"></div>
      <input type="hidden" id="m-candidato-id">
      <button class="btn btn-y" onclick="convertirEnSocio()">âœ… REGISTRAR Y ENVIAR ACCESO POR WA</button>
      <button class="btn btn-r" onclick="closeOverlay('modal-candidato')">CANCELAR</button>
    </div>
  </div>
</div>

<div class="hdr">
  <button class="hdr-back" onclick="logout()">â† SALIR</button>
  <div class="hdr-logo">D'BARRIO <span>ADMIN</span></div>
  <div style="width:72px"></div>
</div>

<div class="tabs">
  <div class="tab on" id="tab-dashboard" onclick="showTab('dashboard')">ğŸ“Š DASH</div>
  <div class="tab" id="tab-candidatos" onclick="showTab('candidatos')">ğŸ‘· CAND<span class="badge-count" id="cnt-cand" style="display:none">0</span></div>
  <div class="tab" id="tab-ordenes" onclick="showTab('ordenes')">ğŸ“‹ Ã“RDS<span class="badge-count" id="cnt-ord" style="display:none">0</span></div>
  <div class="tab" id="tab-archivo" onclick="showTab('archivo')">ğŸ“¦ ARCH</div>
  <div class="tab" id="tab-deudas" onclick="showTab('deudas')">ğŸ’° DEU</div>
  <div class="tab" id="tab-socios" onclick="showTab('socios')">ğŸ‘¥ SOC</div>
  <div class="tab" id="tab-config" onclick="showTab('config')">âš™ï¸ CFG</div>
</div>

<div class="content">

  <div id="sec-dashboard" class="sec on">
    <h2>ğŸ“Š Dashboard</h2>
    <div class="stats">
      <div class="stat"><div class="stat-val" id="d-total">â€”</div><div class="stat-lbl">Ã“rdenes</div></div>
      <div class="stat"><div class="stat-val" id="d-pend" style="color:var(--red)">â€”</div><div class="stat-lbl">Pendientes</div></div>
      <div class="stat"><div class="stat-val" id="d-socios">â€”</div><div class="stat-lbl">Socios</div></div>
      <div class="stat"><div class="stat-val" id="d-ing">â€”</div><div class="stat-lbl">Ingresos</div></div>
    </div>
    <h2>â­ Top Socios</h2>
    <div id="topSocios"><p class="empty">Cargando...</p></div>
  </div>

  <div id="sec-candidatos" class="sec">
    <h2>ğŸ‘· Candidatos a Socio</h2>
    <p style="color:var(--sub);font-size:.85rem;margin-bottom:18px;line-height:1.5">Personas que se registraron desde el formulario "Ãšnete al Equipo". Toca <strong style="color:var(--y)">DAR DE ALTA</strong> para convertirlos en socios con acceso al sistema.</p>
    <div id="listaCandidatos"><p class="empty">Cargando candidatos...</p></div>
  </div>

  <div id="sec-ordenes" class="sec">
    <h2>ğŸ“‹ Ã“rdenes Pendientes</h2>
    <p style="color:var(--sub);font-size:.85rem;margin-bottom:18px;line-height:1.5">âš ï¸ El socio <strong style="color:var(--y)">SOLO VE la orden cuando la asignas aquÃ­.</strong> Sin asignar, no llega a nadie.</p>
    <div id="listaOrdenes"><p class="empty">Cargando Ã³rdenes...</p></div>
  </div>

  <div id="sec-archivo" class="sec">
    <h2>ğŸ“¦ Recibos Pendientes</h2>
    <div id="listaArchivo"><p class="empty">Cargando...</p></div>
  </div>

  <div id="sec-deudas" class="sec">
    <h2>ğŸ’° Deudas de Socios</h2>
    <div id="listaDeudas"><p class="empty">Cargando...</p></div>
  </div>

  <div id="sec-socios" class="sec">
    <h2>ğŸ‘¥ Lista de Socios</h2>
    <div id="listaSocios"><p class="empty">Cargando...</p></div>
  </div>

  <div id="sec-config" class="sec">
    <h2>âš™ï¸ ConfiguraciÃ³n</h2>
    <div class="cfg-box">
      <h3>ğŸ’° ComisiÃ³n Global</h3>
      <p style="color:var(--sub);font-size:.85rem;margin-bottom:12px">Para socios sin comisiÃ³n individual asignada.</p>
      <div class="fld"><label>Porcentaje (%)</label><input type="number" id="cfg-com" min="0" max="100" value="15"></div>
      <button class="btn btn-y" onclick="guardarComision()">ğŸ’¾ GUARDAR COMISIÃ“N</button>
    </div>
    <div class="cfg-box">
      <h3>ğŸ“± NÃºmeros de NotificaciÃ³n</h3>
      <p style="color:var(--sub);font-size:.85rem;margin-bottom:12px">Reciben aviso cuando llega una nueva orden.</p>
      <div class="fld"><label>DueÃ±o (tu WhatsApp)</label><input type="tel" id="cfg-owner" placeholder="+53..."></div>
      <div class="fld"><label>Ayudante (Caramelo)</label><input type="tel" id="cfg-helper" value="+5355165641"></div>
      <button class="btn btn-y" onclick="guardarNotif()">ğŸ’¾ GUARDAR NÃšMEROS</button>
    </div>
    <div class="cfg-box danger">
      <h3>âš ï¸ Zona de Peligro</h3>
      <p style="color:var(--sub);font-size:.85rem;margin-bottom:12px">Borra historial de Ã³rdenes completadas. Requiere PIN.</p>
      <button class="btn btn-r" onclick="pedirPinReset()">ğŸ—‘ï¸ RESETEAR HISTORIAL</button>
    </div>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
firebase.initializeApp({
  apiKey:"AIzaSyAqQyYN7nxMTRsXcISSNYwESX9JYLsTquI",
  authDomain:"delbarrioapp-27247.firebaseapp.com",
  databaseURL:"https://delbarrioapp-27247-default-rtdb.firebaseio.com",
  projectId:"delbarrioapp-27247",
  storageBucket:"delbarrioapp-27247.appspot.com",
  messagingSenderId:"57798249354",
  appId:"1:57798249354:web:18bd75ac7b8469feb35673"
});
const db = firebase.database();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GUARD â€” si no estÃ¡ logueado, fuera
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
if(!localStorage.getItem('db_admin')) window.location.href='index.html';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTADO GLOBAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let comisionGlobal = 15;
let notifConfig = { owner:'', helper:'+5355165641' };
let sociosCache = {};  // cache de socios para uso en Ã³rdenes
let tabActual = 'dashboard';
let listeners = {}; // guardamos referencias a listeners para no duplicar

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ct(t){ return (t||'').replace(/[\s\-\(\)\+]/g,'') }
function money(n){ return '$'+(parseFloat(n)||0).toFixed(2) }
function stars(n){ return 'â­'.repeat(Math.round(n||0))||'â€”' }
function fdate(d){ return d||'â€”' }

function toast(msg, err=false){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className='toast'+(err?' err':'');
  t.style.display='block';
  clearTimeout(t._t); t._t=setTimeout(()=>t.style.display='none',3000);
}

function toggleCard(id){
  const c=document.getElementById(id);
  if(!c) return;
  const wasOpen=c.classList.contains('open');
  document.querySelectorAll('.card.open').forEach(x=>{ if(x.id!==id) x.classList.remove('open'); });
  c.classList.toggle('open',!wasOpen);
}

function closeOverlay(id){ document.getElementById(id).classList.remove('open') }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS â€” un solo listener por secciÃ³n, se destruye al cambiar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(id){
  // Apagar listener anterior si existe
  if(listeners[tabActual]){
    listeners[tabActual].ref.off('value', listeners[tabActual].fn);
    delete listeners[tabActual];
  }
  tabActual = id;
  document.querySelectorAll('.sec').forEach(s=>s.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));
  document.getElementById('sec-'+id).classList.add('on');
  document.getElementById('tab-'+id).classList.add('on');

  if(id==='dashboard') renderDash();
  if(id==='candidatos') renderCandidatos();
  if(id==='ordenes') renderOrdenes();
  if(id==='archivo') renderArchivo();
  if(id==='deudas') renderDeudas();
  if(id==='socios') renderSocios();
  if(id==='config') cargarConfig();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTADORES EN PESTAÃ‘AS (tiempo real)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initContadores(){
  // Candidatos
  db.ref('postulantes').on('value', snap => {
    const n = snap.val() ? Object.keys(snap.val()).length : 0;
    const el=document.getElementById('cnt-cand');
    el.textContent=n; el.style.display=n>0?'flex':'none';
  });
  // Ã“rdenes pendientes
  db.ref('solicitudes').on('value', snap=>{
    const sol=snap.val()||{};
    const n=Object.values(sol).filter(o=>o.estado==='pendiente').length;
    const el=document.getElementById('cnt-ord');
    el.textContent=n; el.style.display=n>0?'flex':'none';
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDash(){
  db.ref('solicitudes').once('value', snap=>{
    const sol=snap.val()||{};
    const total=Object.keys(sol).length;
    const pend=Object.values(sol).filter(o=>o.estado==='pendiente').length;
    let ing=0;
    Object.values(sol).forEach(o=>{ if(o.monto) ing+=o.monto*(comisionGlobal/100) });
    document.getElementById('d-total').textContent=total;
    document.getElementById('d-pend').textContent=pend;
    document.getElementById('d-ing').textContent=money(ing);
  });
  db.ref('socios').once('value', snap=>{
    const soc=snap.val()||{};
    document.getElementById('d-socios').textContent=Object.keys(soc).length;
    const top=Object.entries(soc)
      .map(([id,s])=>({id,...s}))
      .sort((a,b)=>(b.rating||0)-(a.rating||0))
      .slice(0,5);
    document.getElementById('topSocios').innerHTML = top.length
      ? top.map((s,i)=>`
        <div class="card">
          <div class="card-hdr" style="cursor:default">
            <div style="display:flex;align-items:center;gap:12px">
              <span class="rank">${i+1}</span>
              <div><div class="card-title">${s.usuario||s.nombre||'â€”'}</div>
              <div class="card-sub">${s.especialidad||'â€”'} Â· ${s.trabajos||0} trabajos</div></div>
            </div>
            <span style="color:var(--y)">${stars(s.rating)}</span>
          </div>
        </div>`).join('')
      : '<p class="empty">Sin socios aÃºn</p>';
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CANDIDATOS (postulantes/)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCandidatos(){
  const c=document.getElementById('listaCandidatos');
  c.innerHTML='<p class="empty">Cargando...</p>';

  const fn = snap=>{
    const data=snap.val()||{};
    const arr=Object.entries(data);
    if(!arr.length){ c.innerHTML='<p class="empty">Sin candidatos nuevos ğŸ‰</p>'; return; }
    c.innerHTML = arr.reverse().map(([id,p])=>`
      <div class="card cand" id="cand-${id}">
        <div class="card-hdr" onclick="toggleCard('cand-${id}')">
          <div>
            <div class="card-title">${p.nombre||'Sin nombre'}</div>
            <div class="card-sub">${p.oficio||'â€”'} Â· ${p.fecha||'â€”'}</div>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <span class="badge badge-b">NUEVO</span>
            <span class="arrow" style="color:#0088ff">â–¼</span>
          </div>
        </div>
        <div class="card-body">
          <div class="irow"><span class="ilbl">TelÃ©fono</span><span class="ival">${p.telefono||'â€”'}</span></div>
          <div class="irow"><span class="ilbl">Especialidad</span><span class="ival">${p.oficio||'â€”'}</span></div>
          <div class="irow"><span class="ilbl">Zona</span><span class="ival">${p.zona||'â€”'}</span></div>
          <div class="irow"><span class="ilbl">Fecha</span><span class="ival">${p.fecha||'â€”'}</span></div>
          <button class="btn btn-blue-solid" onclick="abrirModalCandidato('${id}','${(p.nombre||'').replace(/'/g,"\\'")}','${(p.telefono||'').replace(/'/g,"\\'")}','${(p.zona||'').replace(/'/g,"\\'")}','${(p.oficio||'').replace(/'/g,"\\'")}')">â¬†ï¸ DAR DE ALTA COMO SOCIO</button>
          <button class="btn btn-g" onclick="window.open('https://wa.me/${ct(p.telefono||'')}','_blank')">ğŸ’¬ WhatsApp</button>
          <button class="btn btn-r" onclick="eliminarCandidato('${id}')">ğŸ—‘ï¸ RECHAZAR Y BORRAR</button>
        </div>
      </div>`).join('');
  };

  const ref=db.ref('postulantes');
  ref.on('value', fn);
  listeners['candidatos']={ ref, fn };
}

function abrirModalCandidato(id, nom, tel, zon, esp){
  document.getElementById('m-candidato-id').value=id;
  document.getElementById('m-nom').value=nom;
  document.getElementById('m-tel').value=tel;
  document.getElementById('m-zon').value=zon;
  document.getElementById('m-esp').value=esp;
  document.getElementById('m-pin').value='';
  document.getElementById('m-com').value=comisionGlobal;
  document.getElementById('modal-candidato').classList.add('open');
}

function convertirEnSocio(){
  const cid=document.getElementById('m-candidato-id').value;
  const nom=document.getElementById('m-nom').value.trim();
  const tel=document.getElementById('m-tel').value.trim();
  const zon=document.getElementById('m-zon').value.trim();
  const esp=document.getElementById('m-esp').value;
  const pin=document.getElementById('m-pin').value.trim();
  const com=parseInt(document.getElementById('m-com').value)||15;

  if(!nom||!tel||!pin||pin.length<4){ toast('âš ï¸ Completa todos los campos y el PIN (4 dÃ­gitos)',true); return; }

  // Crear socio en Firebase
  const newRef=db.ref('socios').push({
    usuario:nom, nombre:nom, telefono:tel, zona:zon,
    especialidad:esp, pin:pin, comision:com,
    deuda:0, disponible:true, admitido:true,
    rating:0, trabajos:0
  });

  // Borrar de postulantes
  db.ref('postulantes/'+cid).remove();

  // Enviar acceso por WhatsApp
  const link=`https://abelbalsinde92-lab.github.io/D-Barrio/socio.html?id=${newRef.key}`;
  const msg=`ğŸ‰ Bienvenido al equipo D'BARRIO, ${nom}!\n\nâœ… Tu acceso personal:\n${link}\n\nğŸ” Tu usuario: ${nom}\nğŸ”‘ Tu PIN: ${pin}\n\nğŸ“± Guarda este mensaje.\nCualquier duda llama al admin.`;
  window.open(`https://wa.me/${ct(tel)}?text=${encodeURIComponent(msg)}`,'_blank');

  closeOverlay('modal-candidato');
  toast(`âœ… ${nom} registrado como socio`);
}

function eliminarCandidato(id){
  if(!confirm('Â¿Rechazar y eliminar este candidato?')) return;
  db.ref('postulantes/'+id).remove();
  toast('ğŸ—‘ï¸ Candidato eliminado');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ã“RDENES PENDIENTES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderOrdenes(){
  const c=document.getElementById('listaOrdenes');
  c.innerHTML='<p class="empty">Cargando...</p>';

  // Primero cargamos socios para el select
  db.ref('socios').once('value', sSnap=>{
    sociosCache=sSnap.val()||{};

    const fn = snap=>{
      const sol=snap.val()||{};
      const pend=Object.entries(sol)
        .filter(([,o])=>o.estado==='pendiente')
        .sort((a,b)=>{ return (b[1].fecha_ts||0)-(a[1].fecha_ts||0) });

      if(!pend.length){
        c.innerHTML='<p class="empty">Sin Ã³rdenes pendientes ğŸ‰<br><span style="font-size:.8rem;color:#666">Las nuevas Ã³rdenes del formulario aparecen aquÃ­ automÃ¡ticamente.</span></p>';
        return;
      }

      c.innerHTML = pend.map(([id,o])=>{
        const tc=ct(o.telefono||'');
        const tecAsig = o.id_tecnico && sociosCache[o.id_tecnico]
          ? (sociosCache[o.id_tecnico].usuario||sociosCache[o.id_tecnico].nombre)
          : null;

        const opcionesSocios = Object.entries(sociosCache)
          .filter(([,s])=>s.admitido)
          .map(([sid,s])=>`<option value="${sid}" data-tel="${s.telefono||''}" data-nom="${s.usuario||s.nombre||''}" ${o.id_tecnico===sid?'selected':''}>
            ${s.disponible?'ğŸŸ¢':'ğŸ”´'} ${s.usuario||s.nombre} â€” ${s.especialidad||''}
          </option>`).join('');

        return`<div class="card hl" id="ord-${id}">
          <div class="card-hdr" onclick="toggleCard('ord-${id}')">
            <div>
              <div class="card-title">${o.cliente||'Sin nombre'}</div>
              <div class="card-sub">${o.categoria||'General'} Â· ${fdate(o.fecha_inicio)}</div>
            </div>
            <div style="display:flex;align-items:center;gap:8px">
              <span class="badge badge-r pulse">PENDIENTE</span>
              <span class="arrow">â–¼</span>
            </div>
          </div>
          <div class="card-body">
            <div class="irow"><span class="ilbl">DirecciÃ³n</span><span class="ival">${o.direccion||'â€”'}</span></div>
            <div class="irow"><span class="ilbl">Problema</span><span class="ival">${o.problema||'â€”'}</span></div>
            <div class="irow"><span class="ilbl">TelÃ©fono</span><span class="ival">${o.telefono||'â€”'}</span></div>
            <div class="irow"><span class="ilbl">TÃ©cnico asignado</span>
              <span class="ival" style="color:${tecAsig?'var(--green)':'var(--red)'}">
                ${tecAsig?'âœ… '+tecAsig:'âŒ Sin asignar'}
              </span>
            </div>
            <hr class="sep">
            <div class="fld"><label>Asignar TÃ©cnico</label>
              <select id="sel-${id}">
                <option value="">â€” Seleccionar tÃ©cnico â€”</option>
                ${opcionesSocios}
              </select>
            </div>
            <button class="btn btn-y" onclick="asignarTecnico('${id}','${(o.cliente||'').replace(/'/g,"\\'")}','${(o.categoria||'').replace(/'/g,"\\'")}','${(o.problema||'').replace(/'/g,"\\'")}','${o.telefono||''}')">
              ğŸ“¤ ASIGNAR Y NOTIFICAR POR WA
            </button>
            <button class="btn btn-g" onclick="window.open('https://wa.me/${tc}','_blank')">ğŸ’¬ WhatsApp Cliente</button>
            <button class="btn btn-b" onclick="window.open('tel:+${tc}','_blank')">ğŸ“ Llamar Cliente</button>
          </div>
        </div>`;
      }).join('');
    };

    const ref=db.ref('solicitudes');
    ref.on('value', fn);
    listeners['ordenes']={ ref, fn };
  });
}

function asignarTecnico(oid, cliente, categoria, problema, telCliente){
  const sel=document.getElementById('sel-'+oid);
  if(!sel){ toast('âš ï¸ Error al leer el selector',true); return; }
  const tid=sel.value;
  if(!tid){ toast('âš ï¸ Selecciona un tÃ©cnico primero',true); return; }
  const opt=sel.options[sel.selectedIndex];
  const telTec=ct(opt.dataset.tel||'');
  const nomTec=opt.dataset.nom||'TÃ©cnico';

  // Actualizar en Firebase con el campo correcto
  db.ref('solicitudes/'+oid).update({ id_tecnico:tid });

  // Mensaje al tÃ©cnico
  const msgTec=`ğŸ”§ NUEVA ORDEN D'BARRIO\n\nğŸ‘¤ Cliente: ${cliente}\nğŸ“ Tel: ${telCliente}\nğŸ·ï¸ ${categoria}\nâš™ï¸ ${problema}\n\nâœ… Asignado a ti. ContÃ¡ctalo cuando puedas.`;
  window.open(`https://wa.me/${telTec}?text=${encodeURIComponent(msgTec)}`,'_blank');

  // Notificar admin/ayudante
  setTimeout(()=>{
    [notifConfig.owner, notifConfig.helper].filter(Boolean).forEach(num=>{
      const n=ct(num);
      if(n){
        const m=`ğŸ“‹ Orden asignada a ${nomTec}\nCliente: ${cliente} Â· ${categoria}`;
        window.open(`https://wa.me/${n}?text=${encodeURIComponent(m)}`,'_blank');
      }
    });
  },1200);

  toast(`âœ… Asignado a ${nomTec} y notificado`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ARCHIVO (recibos listos para enviar)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderArchivo(){
  const c=document.getElementById('listaArchivo');
  c.innerHTML='<p class="empty">Cargando...</p>';

  const fn = snap=>{
    const sol=snap.val()||{};
    const listos=Object.entries(sol).filter(([,o])=>o.estado==='finalizado_pendiente_recibo');
    if(!listos.length){ c.innerHTML='<p class="empty">Sin recibos pendientes âœ…</p>'; return; }
    c.innerHTML=listos.map(([id,o])=>{
      const tc=ct(o.telefono||'');
      const fI=new Date(o.fecha_inicio||Date.now());
      const fV=new Date(fI); fV.setDate(fV.getDate()+30);
      const vStr=fV.toLocaleDateString('es-CU');
      const recibo=`ğŸ›¡ï¸ RECIBO D'BARRIO\n\nCÃ³digo: ${o.codigo_garantia||'â€”'}\nServicio: ${o.categoria||'â€”'}\nTotal: ${money(o.monto)}\nGarantÃ­a hasta: ${vStr}\n\nâœ… Servicio garantizado 30 dÃ­as\nğŸ“ Soporte: wa.me/5355165641`;
      return`<div class="card hl" id="arc-${id}">
        <div class="card-hdr" onclick="toggleCard('arc-${id}')">
          <div><div class="card-title">${o.cliente||'â€”'}</div>
          <div class="card-sub">${money(o.monto)} Â· ${o.categoria||'â€”'}</div></div>
          <div style="display:flex;align-items:center;gap:8px">
            <span class="badge badge-o">RECIBO</span><span class="arrow">â–¼</span>
          </div>
        </div>
        <div class="card-body">
          <div class="irow"><span class="ilbl">CÃ³digo</span><span class="ival">${o.codigo_garantia||'â€”'}</span></div>
          <div class="irow"><span class="ilbl">Monto</span><span class="money">${money(o.monto)}</span></div>
          <div class="irow"><span class="ilbl">GarantÃ­a vence</span><span class="ival">${vStr}</span></div>
          <button class="btn btn-y" onclick="enviarRecibo('${id}','${tc}',\`${recibo}\`)">ğŸ“¤ ENVIAR RECIBO Y COMPLETAR</button>
          <button class="btn btn-g" onclick="window.open('https://wa.me/${tc}','_blank')">ğŸ’¬ WhatsApp Cliente</button>
        </div>
      </div>`;
    }).join('');
  };

  const ref=db.ref('solicitudes');
  ref.on('value', fn);
  listeners['archivo']={ ref, fn };
}

function enviarRecibo(oid, tel, msg){
  db.ref('solicitudes/'+oid).update({ estado:'completado', fecha_fin:new Date().toLocaleDateString('es-CU') });
  window.open(`https://wa.me/${tel}?text=${encodeURIComponent(msg)}`,'_blank');
  toast('âœ… Recibo enviado y orden completada');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEUDAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDeudas(){
  const c=document.getElementById('listaDeudas');
  c.innerHTML='<p class="empty">Cargando...</p>';

  const fn = snap=>{
    const soc=snap.val()||{};
    const arr=Object.entries(soc).filter(([,s])=>s.admitido);
    if(!arr.length){ c.innerHTML='<p class="empty">Sin socios admitidos</p>'; return; }
    c.innerHTML=arr.map(([id,s])=>{
      const tc=ct(s.telefono||'');
      return`<div class="card" id="deu-${id}">
        <div class="card-hdr" onclick="toggleCard('deu-${id}')">
          <div><div class="card-title">${s.usuario||s.nombre||'â€”'} ${stars(s.rating)}</div>
          <div class="card-sub">${s.especialidad||'â€”'} Â· ${s.trabajos||0} trabajos</div></div>
          <div style="display:flex;align-items:center;gap:8px">
            <span class="badge badge-y">${money(s.deuda)}</span><span class="arrow">â–¼</span>
          </div>
        </div>
        <div class="card-body">
          <div class="irow"><span class="ilbl">Zona</span><span class="ival">${s.zona||'â€”'}</span></div>
          <div class="irow"><span class="ilbl">ComisiÃ³n</span><span class="ival">${s.comision||comisionGlobal}%</span></div>
          <div class="irow"><span class="ilbl">Deuda acumulada</span><span class="money">${money(s.deuda)}</span></div>
          <button class="btn btn-y" onclick="liquidar('${id}')">ğŸ’° MARCAR LIQUIDADO</button>
          <button class="btn btn-g" onclick="window.open('https://wa.me/${tc}','_blank')">ğŸ’¬ WhatsApp</button>
        </div>
      </div>`;
    }).join('');
  };

  const ref=db.ref('socios');
  ref.on('value', fn);
  listeners['deudas']={ ref, fn };
}

function liquidar(sid){
  if(!confirm('Â¿Marcar deuda como liquidada?')) return;
  db.ref('socios/'+sid).update({ deuda:0 });
  toast('âœ… Deuda liquidada');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SOCIOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSocios(){
  const c=document.getElementById('listaSocios');
  c.innerHTML='<p class="empty">Cargando...</p>';

  const fn = snap=>{
    const soc=snap.val()||{};
    const arr=Object.entries(soc);
    if(!arr.length){ c.innerHTML='<p class="empty">Sin socios registrados</p>'; return; }
    c.innerHTML=arr.map(([id,s])=>{
      const admitido=s.admitido===true;
      const disp=s.disponible!==false;
      const tc=ct(s.telefono||'');
      return`<div class="card" id="soc-${id}">
        <div class="card-hdr" onclick="toggleCard('soc-${id}')">
          <div style="display:flex;align-items:center;gap:10px">
            <span class="dot ${disp?'dot-g':'dot-r'}"></span>
            <div><div class="card-title">${s.usuario||s.nombre||'â€”'}</div>
            <div class="card-sub">${s.especialidad||'â€”'} Â· ${s.zona||'â€”'}</div></div>
          </div>
          <div style="display:flex;align-items:center;gap:8px">
            <span class="badge ${admitido?'badge-g':'badge-r'}">${admitido?'ADMITIDO':'PENDIENTE'}</span>
            <span class="arrow">â–¼</span>
          </div>
        </div>
        <div class="card-body">
          <div class="irow"><span class="ilbl">TelÃ©fono</span><span class="ival">${s.telefono||'â€”'}</span></div>
          <div class="irow"><span class="ilbl">PIN</span><span class="ival">${s.pin||'â€”'}</span></div>
          <div class="irow"><span class="ilbl">ComisiÃ³n</span><span class="ival">${s.comision||comisionGlobal}%</span></div>
          <div class="irow"><span class="ilbl">Rating</span><span class="ival">${stars(s.rating)} (${(s.rating||0).toFixed(1)})</span></div>
          <div class="irow"><span class="ilbl">Trabajos</span><span class="ival">${s.trabajos||0}</span></div>
          <div class="irow"><span class="ilbl">Deuda</span><span class="money">${money(s.deuda)}</span></div>
          ${admitido
            ?`<button class="btn btn-r" onclick="toggleAdmitido('${id}',false)">ğŸš« REVOCAR ACCESO</button>`
            :`<button class="btn btn-g" onclick="toggleAdmitido('${id}',true)">âœ… ADMITIR AL SISTEMA</button>`}
          <button class="btn btn-g" onclick="window.open('https://wa.me/${tc}','_blank')">ğŸ’¬ WhatsApp</button>
          <button class="btn btn-r" style="margin-top:4px" onclick="eliminarSocio('${id}')">ğŸ—‘ï¸ ELIMINAR SOCIO</button>
        </div>
      </div>`;
    }).join('');
  };

  const ref=db.ref('socios');
  ref.on('value', fn);
  listeners['socios']={ ref, fn };
}

function toggleAdmitido(id,val){
  db.ref('socios/'+id).update({ admitido:val });
  toast(val?'âœ… Socio admitido':'âš ï¸ Acceso revocado');
}

function eliminarSocio(id){
  if(!confirm('Â¿Eliminar este socio definitivamente?')) return;
  db.ref('socios/'+id).remove();
  toast('ğŸ—‘ï¸ Socio eliminado');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cargarConfig(){
  db.ref('config').once('value', snap=>{
    const c=snap.val()||{};
    document.getElementById('cfg-com').value=c.comision||15;
    document.getElementById('cfg-owner').value=c.owner||'';
    document.getElementById('cfg-helper').value=c.helper||'+5355165641';
    comisionGlobal=c.comision||15;
    notifConfig={ owner:c.owner||'', helper:c.helper||'+5355165641' };
  });
}

function guardarComision(){
  const n=parseInt(document.getElementById('cfg-com').value)||15;
  comisionGlobal=n;
  db.ref('config').update({ comision:n });
  toast('âœ… ComisiÃ³n guardada: '+n+'%');
}

function guardarNotif(){
  const o=document.getElementById('cfg-owner').value.trim();
  const h=document.getElementById('cfg-helper').value.trim();
  notifConfig={ owner:o, helper:h };
  db.ref('config').update({ owner:o, helper:h });
  toast('âœ… NÃºmeros guardados');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RESET SISTEMA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pedirPinReset(){
  document.getElementById('reset-pin').value='';
  document.getElementById('overlay-pin').classList.add('open');
}

function confirmarReset(){
  const pin=document.getElementById('reset-pin').value;
  if(pin!=='9202'){ toast('âš ï¸ PIN incorrecto',true); return; }
  db.ref('solicitudes').once('value', snap=>{
    const sol=snap.val()||{};
    const updates={};
    Object.entries(sol).forEach(([id,o])=>{ if(o.estado==='completado') updates[id]=null; });
    if(!Object.keys(updates).length){ toast('Sin historial que borrar'); closeOverlay('overlay-pin'); return; }
    db.ref('solicitudes').update(updates).then(()=>{
      toast('âœ… Historial limpiado');
      closeOverlay('overlay-pin');
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function logout(){
  localStorage.removeItem('db_admin');
  window.location.href='index.html';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
db.ref('config').on('value', snap=>{
  const c=snap.val()||{};
  comisionGlobal=c.comision||15;
  notifConfig={ owner:c.owner||'', helper:c.helper||'+5355165641' };
});

initContadores();
renderDash();

if('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(()=>{});
</script>
</body>
</html>
