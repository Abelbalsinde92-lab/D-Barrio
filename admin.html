<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D'BARRIO ADMIN | Panel Profesional</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --yellow: #F9A825; --yellow-bright: #FFD700; --bg: #000; --card: #1A1A1A; --border: #2A2A2A; --text: #E0E0E0; --concrete: #404040; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto Condensed', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); padding-bottom: 80px; overflow-x: hidden; position: relative; }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, transparent 48%, rgba(42, 42, 42, 0.3) 49%, rgba(42, 42, 42, 0.3) 51%, transparent 52%), linear-gradient(-45deg, transparent 48%, rgba(42, 42, 42, 0.3) 49%, rgba(42, 42, 42, 0.3) 51%, transparent 52%); background-size: 40px 40px; opacity: 0.12; z-index: 0; pointer-events: none; }
        .header { background: var(--card); padding: 15px 20px; border-bottom: 3px solid var(--yellow); position: sticky; top: 0; z-index: 1000; }
        .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.3rem; font-weight: 900; letter-spacing: -1px; color: var(--yellow); text-transform: uppercase; text-shadow: 2px 2px 0 rgba(0,0,0,0.5); }
        .btn-back { background: rgba(249, 168, 37, 0.15); border: 2px solid var(--yellow); color: var(--yellow); padding: 8px 16px; border-radius: 2px; font-size: 0.8rem; font-weight: 900; text-decoration: none; text-transform: uppercase; }
        .btn-back:active { transform: scale(0.95); background: rgba(249, 168, 37, 0.25); }
        .nav-tabs { background: var(--card); display: flex; justify-content: space-around; position: sticky; top: 56px; z-index: 999; border-bottom: 3px solid var(--border); overflow-x: auto; }
        .nav-tab { padding: 14px 8px; cursor: pointer; border-bottom: 3px solid transparent; font-size: 0.7rem; font-weight: 900; white-space: nowrap; flex: 1; text-align: center; text-transform: uppercase; color: var(--concrete); }
        .nav-tab.active { border-bottom-color: var(--yellow); color: var(--yellow); }
        .content { padding: 20px; max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; }
        .section { display: none; }
        .section.active { display: block; }
        h2 { margin-bottom: 20px; color: var(--yellow); font-size: 1.4rem; font-weight: 900; text-transform: uppercase; border-bottom: 3px solid var(--yellow); padding-bottom: 10px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 25px; }
        @media (min-width: 768px) { .stats-grid { grid-template-columns: repeat(4, 1fr); } }
        .stat-box { background: linear-gradient(135deg, #0d0d0d 0%, var(--card) 100%); padding: 18px; border: 3px solid var(--border); text-align: center; }
        .stat-value { font-size: 1.8rem; font-weight: 900; color: var(--yellow); margin-bottom: 5px; }
        .stat-label { font-size: 0.65rem; color: var(--concrete); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
        .card { background: var(--card); border: 3px solid var(--border); margin-bottom: 12px; box-shadow: 0 4px 0 var(--border), 0 8px 20px rgba(0,0,0,0.5); }
        .card.highlight { border-color: var(--yellow); box-shadow: 0 4px 0 #C17900, 0 8px 25px rgba(249, 168, 37, 0.3); }
        .card-header { padding: 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .card-header:active { background: #0d0d0d; }
        .card-title { font-weight: 900; font-size: 0.95rem; text-transform: uppercase; }
        .card-subtitle { font-size: 0.7rem; color: var(--concrete); margin-top: 3px; font-weight: 500; }
        .card-badge { background: var(--yellow); color: #000; padding: 4px 12px; font-size: 0.65rem; font-weight: 900; text-transform: uppercase; }
        .card-badge.alert { background: #FF3B30; color: #fff; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .card-badge.disponible { background: #00D856; }
        .card-badge.ocupado { background: #FF3B30; }
        .stars { color: var(--yellow); font-size: 0.8rem; margin-left: 8px; }
        .card-body { padding: 0 16px; max-height: 0; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .card.open .card-body { padding: 16px; max-height: 3000px; }
        .card-arrow { transition: transform 0.3s; font-size: 16px; color: var(--yellow); }
        .card.open .card-arrow { transform: rotate(180deg); }
        .form-group { margin-bottom: 12px; }
        label { display: block; margin-bottom: 6px; font-size: 0.65rem; color: var(--concrete); font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; }
        input, select, textarea { width: 100%; padding: 12px; background: #050505; border: 2px solid var(--border); color: #fff; font-size: 0.9rem; font-weight: 700; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--yellow); box-shadow: 0 0 0 3px rgba(249, 168, 37, 0.2); }
        .btn { padding: 12px 20px; border: none; font-weight: 900; cursor: pointer; font-size: 0.85rem; width: 100%; margin-top: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-yellow { background: var(--yellow); color: #000; box-shadow: 0 4px 0 #C17900, 0 8px 20px rgba(249, 168, 37, 0.5); }
        .btn-yellow:active { transform: translateY(4px); box-shadow: 0 0 0 #C17900, 0 4px 10px rgba(249, 168, 37, 0.5); }
        .btn-green { background: transparent; border: 3px solid #00D856; color: #00D856; box-shadow: 0 4px 0 var(--border); }
        .btn-blue { background: transparent; border: 3px solid #0088FF; color: #0088FF; box-shadow: 0 4px 0 var(--border); }
        .btn-red { background: rgba(255, 59, 48, 0.15); border: 2px solid #FF3B30; color: #FF3B30; }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: var(--concrete); font-size: 0.8rem; font-weight: 600; }
        .info-value { font-weight: 700; font-size: 0.85rem; }
        .money { color: var(--yellow); font-weight: 900; font-size: 1.1rem; }
        .alert { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #050505; border: 3px solid var(--yellow); padding: 25px; z-index: 10000; display: none; text-align: center; min-width: 280px; max-width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.8); }
        .alert.show { display: block; }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 9999; display: none; }
        .overlay.show { display: block; }
        .warning-banner { background: rgba(249, 168, 37, 0.15); border-left: 4px solid var(--yellow); padding: 12px; margin-bottom: 10px; font-size: 0.8rem; font-weight: 700; }
        .config-section { background: linear-gradient(135deg, #0d0d0d 0%, var(--card) 100%); padding: 20px; border: 3px solid var(--yellow); margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <div class="alert" id="alert"><p id="alertMessage"></p><button class="btn btn-yellow" onclick="closeAlert()">OK</button></div>
    
    <div class="header">
        <div class="header-content">
            <a href="index.html" class="btn-back">‚Üê INICIO</a>
            <div class="logo">D'BARRIO ADMIN</div>
            <div style="width: 70px;"></div>
        </div>
    </div>
    
    <div class="nav-tabs">
        <div class="nav-tab active" onclick="showSection('dashboard')">üìä DASH</div>
        <div class="nav-tab" onclick="showSection('ordenes')">üìã √ìRDEN</div>
        <div class="nav-tab" onclick="showSection('archivo')">üì¶ ARCHIVO</div>
        <div class="nav-tab" onclick="showSection('deudas')">üí∞ DEUDAS</div>
        <div class="nav-tab" onclick="showSection('socios')">üë• SOCIOS</div>
        <div class="nav-tab" onclick="showSection('config')">‚öôÔ∏è CONFIG</div>
    </div>
    
    <div class="content">
        <div id="dashboard" class="section active">
            <h2>üìä ESTAD√çSTICAS</h2>
            <div class="stats-grid">
                <div class="stat-box"><div class="stat-value" id="totalTrabajos">0</div><div class="stat-label">Trabajos</div></div>
                <div class="stat-box"><div class="stat-value" id="pendientes">0</div><div class="stat-label">Pendientes</div></div>
                <div class="stat-box"><div class="stat-value" id="totalSocios">0</div><div class="stat-label">Socios</div></div>
                <div class="stat-box"><div class="stat-value" id="ingresos">$0</div><div class="stat-label">Ingresos</div></div>
            </div>
            <h2>‚≠ê TOP SOCIOS</h2>
            <div id="topSocios"></div>
        </div>
        
        <div id="ordenes" class="section">
            <h2>üìã NUEVA ORDEN</h2>
            <div class="card" id="card-form-orden">
                <div class="card-header" onclick="toggleCard('card-form-orden')">
                    <div class="card-title">‚ûï FORMULARIO</div>
                    <span class="card-arrow">‚ñº</span>
                </div>
                <div class="card-body">
                    <form id="formOrden">
                        <div class="form-group"><label>Cliente</label><input type="text" id="clienteNombre" required></div>
                        <div class="form-group"><label>WhatsApp</label><input type="tel" id="clienteTelefono" placeholder="+53..." required></div>
                        <div class="form-group"><label>Direcci√≥n</label><input type="text" id="clienteDireccion" required></div>
                        <div class="form-group"><label>Categor√≠a</label>
                            <select id="clienteCategoria" required>
                                <option value="">Seleccionar...</option>
                                <option value="Plomer√≠a">üö∞ PLOMER√çA</option>
                                <option value="Electricidad">‚ö° ELECTRICIDAD</option>
                                <option value="Carpinter√≠a">üî® CARPINTER√çA</option>
                                <option value="Alba√±iler√≠a">üß± ALBA√ëILER√çA</option>
                                <option value="Pintura">üé® PINTURA</option>
                                <option value="Refrigeraci√≥n">‚ùÑÔ∏è REFRIGERACI√ìN</option>
                                <option value="Cerrajer√≠a">üîë CERRAJER√çA</option>
                                <option value="Tecnolog√≠a">üíª TECNOLOG√çA</option>
                                <option value="Otro">üîß OTRO</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Problema</label><textarea id="clienteProblema" rows="3" required></textarea></div>
                        <div class="form-group"><label>Asignar Socio</label><select id="selectSocio" required><option value="">Seleccionar...</option></select></div>
                        <button type="submit" class="btn btn-yellow">üì§ CREAR Y ENVIAR</button>
                    </form>
                </div>
            </div>
        </div>
        
        <div id="archivo" class="section">
            <h2>üì¶ RECIBOS</h2>
            <div id="listaArchivo"></div>
        </div>
        
        <div id="deudas" class="section">
            <h2>üí∞ DEUDAS</h2>
            <div id="listaDeudas"></div>
        </div>
        
        <div id="socios" class="section">
            <h2>üë• NUEVO SOCIO</h2>
            <div class="card" id="card-form-socio">
                <div class="card-header" onclick="toggleCard('card-form-socio')">
                    <div class="card-title">‚ûï REGISTRO</div>
                    <span class="card-arrow">‚ñº</span>
                </div>
                <div class="card-body">
                    <form id="formSocio">
                        <div class="form-group"><label>Nombre</label><input type="text" id="socioNombre" required></div>
                        <div class="form-group"><label>WhatsApp</label><input type="tel" id="socioTelefono" placeholder="+53..." required></div>
                        <div class="form-group"><label>Zona</label><input type="text" id="socioZona" required></div>
                        <div class="form-group"><label>Especialidad</label>
                            <select id="socioCategoria" required>
                                <option value="">Seleccionar...</option>
                                <option value="Plomer√≠a">üö∞ PLOMER√çA</option>
                                <option value="Electricidad">‚ö° ELECTRICIDAD</option>
                                <option value="Carpinter√≠a">üî® CARPINTER√çA</option>
                                <option value="Alba√±iler√≠a">üß± ALBA√ëILER√çA</option>
                                <option value="Pintura">üé® PINTURA</option>
                                <option value="Refrigeraci√≥n">‚ùÑÔ∏è REFRIGERACI√ìN</option>
                                <option value="Cerrajer√≠a">üîë CERRAJER√çA</option>
                                <option value="Tecnolog√≠a">üíª TECNOLOG√çA</option>
                                <option value="Multiservicios">üîß MULTISERVICIOS</option>
                            </select>
                        </div>
                        <div class="form-group"><label>PIN (4 d√≠gitos)</label><input type="password" id="socioPin" maxlength="4" pattern="[0-9]{4}" required></div>
                        <button type="submit" class="btn btn-yellow">üíæ GUARDAR Y ENVIAR</button>
                    </form>
                </div>
            </div>
            <h2 style="margin-top: 30px;">üë• LISTA</h2>
            <div id="listaSocios"></div>
        </div>
        
        <div id="config" class="section">
            <h2>‚öôÔ∏è CONFIGURACI√ìN</h2>
            <div class="config-section">
                <h3 style="color: var(--yellow); font-size: 1.1rem; margin-bottom: 15px; text-transform: uppercase;">üí∞ COMISI√ìN</h3>
                <div class="form-group"><label>Porcentaje (%)</label><input type="number" id="comisionPorcentaje" min="0" max="100" step="1" value="15"></div>
                <button class="btn btn-yellow" onclick="guardarComision()">üíæ GUARDAR</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, onValue, update, remove, set } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        const app = initializeApp({apiKey:"AIzaSyAqQyYN7nxMTRsXcISSNYwESX9JYLsTquI",authDomain:"delbarrioapp-27247.firebaseapp.com",databaseURL:"https://delbarrioapp-27247-default-rtdb.firebaseio.com",projectId:"delbarrioapp-27247",storageBucket:"delbarrioapp-27247.firebasestorage.app",messagingSenderId:"57798249354",appId:"1:57798249354:web:18bd75ac7b8469feb35673"});
        const db = getDatabase(app);
        const sociosRef = ref(db, 'socios'), solicitudesRef = ref(db, 'solicitudes'), configRef = ref(db, 'config');
        let comisionActual = 15;
        onValue(configRef, (s) => { const c = s.val(); if (c && c.comision) { comisionActual = c.comision; document.getElementById('comisionPorcentaje').value = comisionActual; } });
        function limpiarTelefono(tel) { return tel.replace(/[\s\-\(\)]/g, '').replace(/^\+/, ''); }
        window.showSection = function(id) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active')); document.getElementById(id).classList.add('active'); event.target.classList.add('active'); if (id === 'dashboard') renderDashboard(); if (id === 'archivo') renderArchivo(); if (id === 'deudas') renderDeudas(); if (id === 'socios') renderSocios(); };
        window.toggleCard = function(id) { const c = document.getElementById(id); document.querySelectorAll('.card').forEach(x => { if (x.id !== id) x.classList.remove('open'); }); c.classList.toggle('open'); };
        window.showAlert = function(msg) { document.getElementById('alertMessage').textContent = msg; document.getElementById('alert').classList.add('show'); document.getElementById('overlay').classList.add('show'); };
        window.closeAlert = function() { document.getElementById('alert').classList.remove('show'); document.getElementById('overlay').classList.remove('show'); };
        window.guardarComision = function() { const n = parseFloat(document.getElementById('comisionPorcentaje').value); set(configRef, { comision: n }); showAlert(`‚úÖ Comisi√≥n ${n}%`); };
        function renderDashboard() { onValue(solicitudesRef, (s) => { const sol = s.val(); let t = 0, p = 0, ing = 0; if (sol) { t = Object.keys(sol).length; Object.values(sol).forEach(o => { if (o.estado === 'pendiente') p++; if (o.monto) ing += o.monto * (comisionActual / 100); }); } document.getElementById('totalTrabajos').textContent = t; document.getElementById('pendientes').textContent = p; document.getElementById('ingresos').textContent = '$' + ing.toFixed(2); }, { onlyOnce: true }); onValue(sociosRef, (s) => { const soc = s.val(); document.getElementById('totalSocios').textContent = soc ? Object.keys(soc).length : 0; const c = document.getElementById('topSocios'); c.innerHTML = ''; if (soc) { const arr = Object.entries(soc).map(([id, d]) => ({ id, ...d, rating: d.rating || 0, trabajos: d.trabajos || 0 })).sort((a, b) => b.rating - a.rating).slice(0, 5); arr.forEach(so => { const st = '‚≠ê'.repeat(Math.round(so.rating)); c.innerHTML += `<div class="card"><div class="card-header"><div><div class="card-title">${so.usuario}</div><div class="card-subtitle">${so.especialidad} - ${so.trabajos} trabajos</div></div><div class="stars">${st || '‚≠ê'}</div></div></div>`; }); } }, { onlyOnce: true }); }
        onValue(sociosRef, (s) => { const sel = document.getElementById('selectSocio'); sel.innerHTML = '<option value="">Seleccionar...</option>'; const soc = s.val(); if (soc) { Object.keys(soc).forEach(id => { const so = soc[id]; const disp = so.disponible ? 'üü¢' : 'üî¥'; const rat = so.rating ? `‚≠ê${so.rating.toFixed(1)}` : ''; const opt = document.createElement('option'); opt.value = id; opt.dataset.telefono = so.telefono; opt.textContent = `${disp} ${so.usuario} - ${so.especialidad} ${rat}`; sel.appendChild(opt); }); } });
        document.getElementById('formOrden').addEventListener('submit', function(e) { e.preventDefault(); const cli = document.getElementById('clienteNombre').value, tel = document.getElementById('clienteTelefono').value, dir = document.getElementById('clienteDireccion').value, cat = document.getElementById('clienteCategoria').value, prob = document.getElementById('clienteProblema').value, sel = document.getElementById('selectSocio'), tecId = sel.value; if (!tecId) { showAlert('‚ö†Ô∏è Selecciona socio'); return; } const telSoc = sel.options[sel.selectedIndex].dataset.telefono; push(solicitudesRef, { cliente: cli, telefono: tel, direccion: dir, categoria: cat, problema: prob, tecnico: tecId, estado: 'pendiente', fecha_inicio: new Date().toISOString().split('T')[0], fecha_fin: null, monto: 0, codigo_garantia: null, valoracion: 0 }); const telC = limpiarTelefono(tel), msg = `üîß NUEVA ORDEN\n\nüë§ ${cli}\nüìû ${tel}\nüìç ${dir}\nüè∑Ô∏è ${cat}\n‚öôÔ∏è ${prob}\n\n‚úÖ https://wa.me/${telC}`; window.open(`https://wa.me/${limpiarTelefono(telSoc)}?text=${encodeURIComponent(msg)}`, '_blank'); this.reset(); showAlert('‚úÖ Orden creada'); document.getElementById('card-form-orden').classList.remove('open'); });
        document.getElementById('formSocio').addEventListener('submit', function(e) { e.preventDefault(); const nom = document.getElementById('socioNombre').value, tel = document.getElementById('socioTelefono').value, zon = document.getElementById('socioZona').value, esp = document.getElementById('socioCategoria').value, pin = document.getElementById('socioPin').value; const nRef = push(sociosRef, { usuario: nom, telefono: tel, zona: zon, especialidad: esp, pin: pin, deuda: 0, disponible: true, rating: 0, trabajos: 0 }); const link = window.location.origin + '/socio.html?id=' + nRef.key, msgBien = `üéâ Bienvenido a D'Barrio\n\n‚úÖ Tu acceso:\n${link}\n\nüîê PIN: ${pin}\n\nüì± Guarda este mensaje`; window.open(`https://wa.me/${limpiarTelefono(tel)}?text=${encodeURIComponent(msgBien)}`, '_blank'); this.reset(); showAlert('‚úÖ Socio registrado'); document.getElementById('card-form-socio').classList.remove('open'); setTimeout(() => renderSocios(), 1000); });
        function renderArchivo() { onValue(solicitudesRef, (s) => { const c = document.getElementById('listaArchivo'); c.innerHTML = ''; const sol = s.val(); if (!sol) { c.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Sin √≥rdenes</p>'; return; } let hay = false; Object.keys(sol).forEach(id => { const o = sol[id]; if (o.estado === 'finalizado_pendiente_recibo') { hay = true; const fI = new Date(o.fecha_inicio), fV = new Date(fI); fV.setDate(fV.getDate() + 30); const vStr = fV.toISOString().split('T')[0], msg = `üõ°Ô∏è Garant√≠a D'Barrio\n\nüìã ${o.codigo_garantia}\nüíµ $${o.monto.toFixed(2)}\nüìÖ Vence: ${vStr}\n\nüìû +34627493593`, telC = limpiarTelefono(o.telefono); c.innerHTML += `<div class="card highlight" id="orden-${id}"><div class="card-header" onclick="toggleCard('orden-${id}')"><div><div class="card-title">${o.cliente}</div><div class="card-subtitle">$${o.monto.toFixed(2)} - ${o.categoria || 'General'}</div></div><div style="display: flex; gap: 8px; align-items: center;"><span class="card-badge alert">LISTO</span><span class="card-arrow">‚ñº</span></div></div><div class="card-body"><div class="warning-banner">‚ö†Ô∏è LISTO RECIBO</div><div class="info-row"><span class="info-label">C√≥digo:</span><span class="info-value">${o.codigo_garantia}</span></div><div class="info-row"><span class="info-label">Monto:</span><span class="money">$${o.monto.toFixed(2)}</span></div><div class="info-row"><span class="info-label">Vence:</span><span class="info-value">${vStr}</span></div><button class="btn btn-green" onclick="window.open('https://wa.me/${telC}', '_blank')">üí¨ WhatsApp</button><button class="btn btn-blue" onclick="window.open('tel:+${telC}', '_blank')">üìû Llamar</button><button class="btn btn-yellow" onclick="enviarRecibo('${id}', '${telC}', \`${msg}\`)">üì§ ENVIAR Y COMPLETAR</button></div></div>`; } }); if (!hay) c.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Sin recibos pendientes</p>'; }, { onlyOnce: true }); }
        window.enviarRecibo = function(oId, tel, msg) { update(ref(db, `solicitudes/${oId}`), { estado: 'completado', fecha_fin: new Date().toISOString().split('T')[0] }); window.open(`https://wa.me/${tel}?text=${encodeURIComponent(msg)}`, '_blank'); showAlert('‚úÖ Recibo enviado'); setTimeout(() => renderArchivo(), 1000); };
        function renderDeudas() { onValue(sociosRef, (s) => { const c = document.getElementById('listaDeudas'); c.innerHTML = ''; const soc = s.val(); if (!soc) { c.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Sin socios</p>'; return; } Object.keys(soc).forEach(id => { const so = soc[id], telC = limpiarTelefono(so.telefono), st = so.rating ? '‚≠ê'.repeat(Math.round(so.rating)) : '‚≠ê'; c.innerHTML += `<div class="card" id="deuda-${id}"><div class="card-header" onclick="toggleCard('deuda-${id}')"><div><div class="card-title">${so.usuario} <span class="stars">${st}</span></div><div class="card-subtitle">${so.especialidad} - ${so.trabajos || 0} trabajos</div></div><div style="display: flex; gap: 8px; align-items: center;"><span class="card-badge">$${(so.deuda || 0).toFixed(2)}</span><span class="card-arrow">‚ñº</span></div></div><div class="card-body"><div class="info-row"><span class="info-label">Zona:</span><span class="info-value">${so.zona}</span></div><div class="info-row"><span class="info-label">Tel:</span><span class="info-value">${so.telefono}</span></div><div class="info-row"><span class="info-label">Deuda:</span><span class="money">$${(so.deuda || 0).toFixed(2)}</span></div><button class="btn btn-yellow" onclick="liquidarDeuda('${id}')">üí∞ LIQUIDAR</button><button class="btn btn-green" onclick="window.open('https://wa.me/${telC}', '_blank')">üí¨ WhatsApp</button><button class="btn btn-blue" onclick="window.open('tel:+${telC}', '_blank')">üìû Llamar</button></div></div>`; }); }, { onlyOnce: true }); }
        window.liquidarDeuda = function(sId) { if (confirm('¬øLiquidar?')) { update(ref(db, `socios/${sId}`), { deuda: 0 }); showAlert('‚úÖ Liquidada'); setTimeout(() => renderDeudas(), 1000); } };
        function renderSocios() { onValue(sociosRef, (s) => { const c = document.getElementById('listaSocios'); c.innerHTML = ''; const soc = s.val(); if (!soc) { c.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Sin socios</p>'; return; } Object.keys(soc).forEach(id => { const so = soc[id], disp = so.disponible ? 'disponible' : 'ocupado', dispT = so.disponible ? 'üü¢ DISPONIBLE' : 'üî¥ OCUPADO', telC = limpiarTelefono(so.telefono), st = so.rating ? '‚≠ê'.repeat(Math.round(so.rating)) : '‚≠ê'; c.innerHTML += `<div class="card" id="socio-${id}"><div class="card-header" onclick="toggleCard('socio-${id}')"><div><div class="card-title">${so.usuario} <span class="stars">${st}</span></div><div class="card-subtitle">${so.especialidad} - ${so.zona} - ${so.trabajos || 0} trabajos</div></div><div style="display: flex; gap: 8px; align-items: center;"><span class="card-badge ${disp}" style="width: 10px; height: 10px; border-radius: 50%; padding: 3px 6px;" title="${dispT}"></span><span class="card-arrow">‚ñº</span></div></div><div class="card-body"><div class="info-row"><span class="info-label">Estado:</span><span class="info-value">${dispT}</span></div><div class="info-row"><span class="info-label">Tel:</span><span class="info-value">${so.telefono}</span></div><div class="info-row"><span class="info-label">PIN:</span><span class="info-value">${so.pin}</span></div><div class="info-row"><span class="info-label">Rating:</span><span class="info-value">${so.rating ? so.rating.toFixed(1) + '/5' : 'Sin calif.'}</span></div><button class="btn btn-green" onclick="window.open('https://wa.me/${telC}', '_blank')">üí¨ WhatsApp</button><button class="btn btn-red" onclick="eliminarSocio('${id}')">üóëÔ∏è ELIMINAR</button></div></div>`; }); }, { onlyOnce: true }); }
        window.eliminarSocio = function(sId) { if (confirm('‚ö†Ô∏è ¬øEliminar?')) { remove(ref(db, `socios/${sId}`)); showAlert('‚úÖ Eliminado'); setTimeout(() => renderSocios(), 1000); } };
        renderDashboard();
    </script>
</body>
</html>
